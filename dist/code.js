(()=>{figma.showUI(__html__,{height:490}),figma.currentPage.selection=[];let e,t="refracted-color-page";figma.ui.onmessage=o=>{if("glassify"===o.type){figma.currentPage.selection[0]||(e=figma.notify("Please select a layer to continue"));for(let e of figma.currentPage.selection)y(e,o.lightIntensity,o.lightColor,o.bgColor,o.strokeWeight,o.blur)}"deselect-all-selections"===o.type&&(figma.currentPage.selection=[]),"on-refracted-color-page"===o.type&&(t="refracted-color-page"),"on-glassify-page"===o.type&&(t="glassify-page")},figma.on("selectionchange",(()=>{if("refracted-color-page"==t){if(console.log("page",t,figma.currentPage.selection[0]),!figma.currentPage.selection[0])return;if(!figma.currentPage.selection[0].fills||!figma.currentPage.selection[0].fills.some((e=>"SOLID"===e.type))&&!figma.currentPage.selection[0].fills.some((e=>e.type.startsWith("GRADIENT"))))return e=figma.notify("Please select a layer that's not a group and has at least 1 solid or gradient fill"),void(figma.currentPage.selection=[]);e&&e.cancel();const a=o(figma.currentPage.selection[0].fills),i=r(a),s=i.map((e=>n(e))),l=[...new Set(s)];l.length?figma.ui.postMessage({type:"selection-made",isValid:!0}):figma.ui.postMessage({type:"selection-made",isValid:!1}),figma.ui.postMessage({type:"refracted-color-options",colors:l}),console.log(figma.currentPage.selection[0],i,s,l)}if("glassify-page"===t){if(console.log("page",t,figma.currentPage.selection.map((e=>e.type))),!figma.currentPage.selection[0])return;figma.currentPage.selection.some((e=>"COMPONENT"==e.type||"COMPONENT_SET"==e.type||"INSTANCE"==e.type||"GROUP"==e.type))&&(e=figma.notify("For groups or components, you should target any or all of their children instead"),figma.currentPage.selection=figma.currentPage.selection.filter((e=>"COMPONENT"!==e.type&&"COMPONENT_SET"!==e.type&&"INSTANCE"!==e.type&&"GROUP"!==e.type))),e&&e.cancel()}}));const o=e=>e.reduce(((e,t)=>{if("SOLID"===t.type)e.push(t.color);else if(t.type.startsWith("GRADIENT")){const o=t.gradientStops.map((e=>e.color));e=[...e,...o]}return e}),[]),r=e=>e.map((e=>({r:Math.round(255*e.r),g:Math.round(255*e.g),b:Math.round(255*e.b)}))),a=e=>e.split("").reverse().reduce(((e,t,o)=>{var r;return e+parseInt("a"===(r=t)||"A"===r?"10":"b"===r||"B"===r?"11":"c"===r||"C"===r?"12":"d"===r||"D"===r?"13":"e"===r||"E"===r?"14":"f"===r||"F"===r?"15":r)*Math.pow(16,o)}),0),i=e=>{let t=e,o=[];for(;0!==t;){let e=t%16;o.push(e),t=Math.floor(t/16)}return o=o.map((e=>{switch(e){case 10:return"A";case 11:return"B";case 12:return"C";case 13:return"D";case 14:return"E";case 15:return"F";default:return e.toString()}})),0===e?"00":o.reverse().reduce(((e,t)=>e+t),"")},s=(e,t=0)=>{const o=e.slice(1,3),r=e.slice(3,5),i=e.slice(5,7),s=a(o),n=a(r),l=a(i);return console.log("huha",s,n,l),{r:s/255,g:n/255,b:l/255,a:t}},n=({r:e,g:t,b:o})=>"#"+i(e)+i(t)+i(o),l=(e,t)=>{const o=s(e);return{r:Math.min(1,1.1*o.r),g:Math.min(1,1.1*o.g),b:Math.min(1,1.1*o.b),a:t}},g=[.3572564721107483,.16031566262245178,.49201685190200806],c=[-.16012853384017944,.16538913547992706,.49651965498924255];let p={type:"GRADIENT_RADIAL",visible:!0,opacity:1,blendMode:"NORMAL",gradientStops:[{color:{r:1,g:1,b:1,a:.4},position:0},{color:{r:1,g:1,b:1,a:0},position:1}],gradientTransform:[g,c]},f={type:"GRADIENT_RADIAL",visible:!0,opacity:1,blendMode:"NORMAL",gradientStops:[{color:{r:.40572917461395264,g:.6258341670036316,b:.7916666865348816,a:1},position:0},{color:{r:.40392157435417175,g:.6274510025978088,b:.7921568751335144,a:0},position:1}],gradientTransform:[g,c]},u={type:"GRADIENT_RADIAL",visible:!0,opacity:1,blendMode:"NORMAL",gradientStops:[{color:{r:.19055557250976562,g:.5476345419883728,b:.8166666626930237,a:1},position:0},{color:{r:.1921568661928177,g:.5490196347236633,b:.8156862854957581,a:0},position:1}],gradientTransform:[[.38503000140190125,-.13427551090717316,.6248728632926941],[.16108153760433197,.166435107588768,.33643829822540283]]},d={type:"GRADIENT_LINEAR",visible:!0,opacity:1,blendMode:"NORMAL",gradientStops:[{color:{r:1,g:1,b:1,a:.9},position:0},{color:{r:1,g:1,b:1,a:0},position:1}],gradientTransform:[[.7149112820625305,.32662856578826904,-.022147150710225105],[-.3259817957878113,.3308306634426117,.49701404571533203]]};const m=[{type:"BACKGROUND_BLUR",radius:42,visible:!0}],y=(e,t,o,r,a,i)=>{d.gradientStops[0].color=s(o,t/100),d.gradientStops[1].color=s(o),p.gradientStops[0].color=s(o,.4),f.gradientStops[0].color=l(r,0),f.gradientStops[1].color=l(r,1),u.gradientStops[0].color=l(r,0),u.gradientStops[1].color=l(r,1),m.find((e=>"BACKGROUND_BLUR"===e.type)).radius=i,e.fills=[p],e.strokes=[f,u,d],e.strokeWeight=a,e.effects=m,figma.closePlugin()}})();