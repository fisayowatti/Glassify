(()=>{figma.showUI(__html__,{height:490}),figma.currentPage.selection=[];let e,t="refracted-color-page";figma.ui.onmessage=r=>{if("glassify"===r.type){figma.currentPage.selection[0]||(e=figma.notify("Please select a layer to continue"));for(let e of figma.currentPage.selection)y(e,r.lightIntensity,r.lightColor,r.bgColor,r.strokeWeight,r.blur)}"deselect-all-selections"===r.type&&(figma.currentPage.selection=[]),"on-refracted-color-page"===r.type&&(t="refracted-color-page"),"on-glassify-page"===r.type&&(t="glassify-page")},figma.on("selectionchange",(()=>{if("refracted-color-page"==t){if(!figma.currentPage.selection[0])return;if(!figma.currentPage.selection[0].fills||!figma.currentPage.selection[0].fills.some((e=>"SOLID"===e.type))&&!figma.currentPage.selection[0].fills.some((e=>e.type.startsWith("GRADIENT"))))return e=figma.notify("Please select a layer that's not a group and has at least 1 solid or gradient fill"),void(figma.currentPage.selection=[]);e&&e.cancel();const t=r(figma.currentPage.selection[0].fills),i=o(t).map((e=>n(e))),a=[...new Set(i)];a.length?figma.ui.postMessage({type:"selection-made",isValid:!0}):figma.ui.postMessage({type:"selection-made",isValid:!1}),figma.ui.postMessage({type:"refracted-color-options",colors:a})}if("glassify-page"===t){if(!figma.currentPage.selection[0])return;figma.currentPage.selection.some((e=>"COMPONENT"==e.type||"COMPONENT_SET"==e.type||"INSTANCE"==e.type||"GROUP"==e.type))&&(e=figma.notify("For groups or components, you should target any or all of their children instead"),figma.currentPage.selection=figma.currentPage.selection.filter((e=>"COMPONENT"!==e.type&&"COMPONENT_SET"!==e.type&&"INSTANCE"!==e.type&&"GROUP"!==e.type))),e&&e.cancel()}}));const r=e=>e.reduce(((e,t)=>{if("SOLID"===t.type)e.push(t.color);else if(t.type.startsWith("GRADIENT")){const r=t.gradientStops.map((e=>e.color));e=[...e,...r]}return e}),[]),o=e=>e.map((e=>({r:Math.round(255*e.r),g:Math.round(255*e.g),b:Math.round(255*e.b)}))),i=e=>e.split("").reverse().reduce(((e,t,r)=>{var o;return e+parseInt("a"===(o=t)||"A"===o?"10":"b"===o||"B"===o?"11":"c"===o||"C"===o?"12":"d"===o||"D"===o?"13":"e"===o||"E"===o?"14":"f"===o||"F"===o?"15":o)*Math.pow(16,r)}),0),a=e=>{let t=e,r=[];for(;0!==t;){let e=t%16;r.push(e),t=Math.floor(t/16)}return r=r.map((e=>{switch(e){case 10:return"A";case 11:return"B";case 12:return"C";case 13:return"D";case 14:return"E";case 15:return"F";default:return e.toString()}})),0===e?"00":r.reverse().reduce(((e,t)=>e+t),"")},s=(e,t=0)=>{const r=e.slice(1,3),o=e.slice(3,5),a=e.slice(5,7);return{r:i(r)/255,g:i(o)/255,b:i(a)/255,a:t}},n=({r:e,g:t,b:r})=>"#"+a(e)+a(t)+a(r),l=(e,t)=>{const r=s(e);return{r:Math.min(1,1.1*r.r),g:Math.min(1,1.1*r.g),b:Math.min(1,1.1*r.b),a:t}},c=[.3572564721107483,.16031566262245178,.49201685190200806],g=[-.16012853384017944,.16538913547992706,.49651965498924255];let p={type:"GRADIENT_RADIAL",visible:!0,opacity:1,blendMode:"NORMAL",gradientStops:[{color:{r:1,g:1,b:1,a:.4},position:0},{color:{r:1,g:1,b:1,a:0},position:1}],gradientTransform:[c,g]},f={type:"GRADIENT_RADIAL",visible:!0,opacity:1,blendMode:"NORMAL",gradientStops:[{color:{r:.40572917461395264,g:.6258341670036316,b:.7916666865348816,a:1},position:0},{color:{r:.40392157435417175,g:.6274510025978088,b:.7921568751335144,a:0},position:1}],gradientTransform:[c,g]},d={type:"GRADIENT_RADIAL",visible:!0,opacity:1,blendMode:"NORMAL",gradientStops:[{color:{r:.19055557250976562,g:.5476345419883728,b:.8166666626930237,a:1},position:0},{color:{r:.1921568661928177,g:.5490196347236633,b:.8156862854957581,a:0},position:1}],gradientTransform:[[.38503000140190125,-.13427551090717316,.6248728632926941],[.16108153760433197,.166435107588768,.33643829822540283]]},u={type:"GRADIENT_LINEAR",visible:!0,opacity:1,blendMode:"NORMAL",gradientStops:[{color:{r:1,g:1,b:1,a:.9},position:0},{color:{r:1,g:1,b:1,a:0},position:1}],gradientTransform:[[.7149112820625305,.32662856578826904,-.022147150710225105],[-.3259817957878113,.3308306634426117,.49701404571533203]]};const m=[{type:"BACKGROUND_BLUR",radius:42,visible:!0}],y=(e,t,r,o,i,a)=>{u.gradientStops[0].color=s(r,t/100),u.gradientStops[1].color=s(r),p.gradientStops[0].color=s(r,.4),f.gradientStops[0].color=l(o,0),f.gradientStops[1].color=l(o,1),d.gradientStops[0].color=l(o,0),d.gradientStops[1].color=l(o,1),m.find((e=>"BACKGROUND_BLUR"===e.type)).radius=a,e.fills=[p],e.strokes=[f,d,u],e.strokeWeight=i,e.effects=m,figma.closePlugin()}})();